!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}(0,window.define)("idcta-v2/profileSwitcher",["idcta-v2/idcta-1","idcta-v2/id-config","idcta-v2/apiUtils","idcta-v2/idCookie"],(function(t,i,r,n){var a,s,o,c,l,d,u,f={},p=!1,m=i.getFeatureDecisions();function h(){var e,t,i,r=(e=s.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop,{bottom:e.bottom+i,left:e.left+t});a.style.top="".concat(r.bottom,"px"),a.style.left="".concat(r.left,"px")}function v(){var e=u.profiles_list_url;return fetch(e,{credentials:"include"}).then((function(e){return e.json()}))}function _(){o.classList.add("u-hidden")}function g(){_(),l.classList.remove("u-hidden")}function L(){var e=document.querySelector(".profile-switcher a:not(.profile-switcher__account-link), .profile-switcher button");e&&e.focus()}function w(e,t){return e.length<=t?e:"".concat(e.substring(0,t).trim(),"&hellip;")}function y(e){return"admin"===e}function b(e,t){var i=e.activeProfileId||"admin",a=y(i)?"adult-":"child-",s=e.permissions.create,o=[];if([{id:"admin",displayName:e.profileAdmin.displayName,email:e.profileAdmin.email,username:e.profileAdmin.username}].concat(e.profiles).forEach((function(e){var s=e.displayName||e.username||e.email;e.primaryText=w(s,20),e.email&&e.displayName&&(e.secondaryText=w(e.email,27)),e.avatarLetter=function(e){return e.primaryText[0].toUpperCase()}(e),e.url=function(e,t){var i=r.appendQueryParameters(e.signin_url,{ptrt:encodeURIComponent(window.location.href)});return"".concat(i,"&switchTld=1&profileId=").concat(t.id)}(u,e),e.isActive=e.id===i;var c=y(e.id)?"adult":"child";if(e.actionName=a+c,y(e.id)&&e.isActive)if("GREEN"===u["foryou-flagpole"]){var l=n.getInstance();if(m.removeForYouAccessChanceCheck){var d=r.getStatusURL(l,u,void 0,t,!0),f=d.statusURL,p=d.statusName;e.settingsUrl=f,e.statusName=p}else{var h=l.getUserDetailsFromCookie();m.forYouGeoIp?l.calculatePn(h,t):l.calculatePn(h);var v=r.getStatusURL(l,u),_=v.statusURL,g=v.statusName;e.settingsUrl=_,e.statusName=g}}else e.settingsUrl=u.status_url;e.isActive?o.unshift(e):o.push(e)})),s){var c={primaryText:u.translation_profile_switcher_add_child,avatarIcon:"add-profile",url:u.profiles_create_url,actionName:"add-profile"};o.push(c)}return o}function E(e){var t;e.isActive?(t=document.createElement("div")).classList.add("profile-switcher__list-item--active"):((t=document.createElement("a")).href=e.url,t.setAttribute("data-bbc-container","switch-user"),t.setAttribute("data-bbc-title",e.actionName)),t.classList.add("profile-switcher__list-item");var i=document.createElement("div");i.classList.add("avatar"),i.classList.add("avatar--nona"),i.setAttribute("aria-hidden","true"),e.avatarLetter&&(i.innerHTML=e.avatarLetter),"add-profile"===e.avatarIcon&&(i.classList.add("avatar__icon"),i.classList.add("avatar__icon--add-profile")),t.appendChild(i);var r=document.createElement("div");if(r.classList.add("profile-switcher__wrapper"),t.appendChild(r),e.primaryText){var n=document.createElement("p");n.classList.add("profile-switcher__primary-text"),n.innerHTML=e.primaryText,r.appendChild(n)}if(e.secondaryText){var a=document.createElement("p");a.innerHTML=e.secondaryText,a.classList.add("profile-switcher__secondary-text"),r.appendChild(a)}if(e.settingsUrl){var s=document.createElement("a");e.settingsUrl=e.settingsUrl.includes("foryou?")?e.settingsUrl.split("?")[0]:e.settingsUrl,s.href=e.settingsUrl;var o=u.translation_profile_switcher_account_settings,c=u.translation_foryou;if("GREEN"===u["foryou-flagpole"]){s.innerHTML="foryou"===e.statusName?c:o;var l="foryou"===e.statusName?"foryou":"settings";s.classList.add("profile-switcher__".concat(l))}else s.innerHTML=u.translation_profile_switcher_account_settings,s.classList.add("profile-switcher__settings");var d=document.createElement("div");d.appendChild(s),r.appendChild(d)}var f=document.createElement("li");return f.appendChild(t),f}function C(e){e.map(E).forEach((function(e){c.appendChild(e)}))}function T(){if(p=!0,m.forYouGeoIp){var t=[v(),window&&window.bbcuser&&window.bbcuser.isUKCombined()];return Promise.all(t).then((function(t){var i,r,n=(r=2,function(e){if(Array.isArray(e))return e}(i=t)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,a,s,o=[],c=!0,l=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;c=!1}else for(;!(c=(r=a.call(i)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){l=!0,n=e}finally{try{if(!c&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(l)throw n}}return o}}(i,r)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,i):void 0}}(i,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return b(n[0],n[1])})).then(C).then(_).catch(g).then(L)}return v().then(b).then(C).then(_).catch(g).then(L)}function A(){return h(),a.classList.toggle("u-visible"),p?L():T()}return f.init=function(){s=document.querySelector("#idcta-link");var e=t.getCookieInstance(),r=e.getUserDetailsFromCookie(),n=e.getCookie("ckns_profile",!0),f=r&&"o18"===r.ab;if((n||f)&&s)return i.getConfigAsync().then((function(e){u=e,function(e){(a=document.createElement("div")).classList.add("profile-switcher"),a.setAttribute("role","dialog");var t=document.createElement("div");t.classList.add("profile-switcher__container"),a.appendChild(t);var i=document.createElement("p"),r="profile-switcher-heading";if(i.id=r,a.setAttribute("aria-labelledby",r),i.classList.add("profile-switcher__heading"),i.innerHTML=u.translation_profile_switcher_switch_user,t.appendChild(i),(o=document.createElement("div")).classList.add("profile-switcher__spinner"),o.classList.add("spinner"),a.appendChild(o),(c=document.createElement("ul")).classList.add("profile-switcher__list"),t.appendChild(c),e&&m.enableManageAccount){var n=document.createElement("div"),s=document.createElement("a");n.classList.add("profile-switcher__manage-account"),s.classList.add("profile-switcher__account-link"),s.innerHTML=u.translation_profile_switcher_manage_account,s.href=u.settings_url,n.appendChild(s),t.appendChild(n)}if(function(){(l=document.createElement("div")).classList.add("profile-switcher__error"),l.classList.add("u-hidden");var e=document.createElement("p");e.classList.add("profile-switcher__error-heading"),e.innerHTML=u.translation_profile_switcher_default_error,l.appendChild(e);var t=document.createElement("p");t.classList.add("profile-switcher__error-subheading"),t.innerHTML=u.translation_profile_switcher_try_again,l.appendChild(t),(d=document.createElement("button")).classList.add("profile-switcher__error-retry-button"),d.classList.add("button"),d.classList.add("button--small"),d.innerHTML=u.translation_profile_switcher_retry,l.appendChild(d),a.appendChild(l)}(),e){var f=document.createElement("div");f.classList.add("profile-switcher__footer"),a.appendChild(f);var p=document.createElement("a");p.href=u.tokenRefresh_signout_url,p.innerHTML=u.translation_signout,f.appendChild(p)}document.body.appendChild(a)}(f),window.addEventListener("resize",h),s.href="#",s.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),A()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&a.classList.remove("u-visible")})),document.addEventListener("click",(function(e){var t=e.target===a,i=a.contains(e.target);t||i||a.classList.remove("u-visible")})),d.addEventListener("click",(function(){p=!1,l.classList.add("u-hidden"),o.classList.remove("u-hidden"),T()}))}))},f.toggle=A,f}))}();